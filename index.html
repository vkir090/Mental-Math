<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mental Math & MM Trainer</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <style>
    :root{--bg:#0f1220;--panel:#151936;--accent:#7bd88f;--accent2:#8bd3ff;--text:#eef1ff;--muted:#a8b0d3;--danger:#ff6b6b;--warn:#ffd166}
    *{box-sizing:border-box}html,body{height:100%}body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;color:var(--text);background:radial-gradient(1000px 600px at 10% -10%, #1a1f45 0%, #0f1220 60%)}
    header{position:sticky;top:0;z-index:3;backdrop-filter:blur(8px);background:rgb(15 18 32 / 70%);border-bottom:1px solid #232955;padding:12px 16px;display:flex;align-items:center;gap:12px;flex-wrap:wrap}
    header h1{font-size:18px;margin:0;letter-spacing:.3px}
    nav{display:flex;gap:8px;flex-wrap:wrap}
    nav button{background:var(--panel);color:var(--text);border:1px solid #232955;padding:8px 12px;border-radius:10px;cursor:pointer}
    nav button.active{border-color:var(--accent);box-shadow:0 0 0 2px rgb(123 216 143 / .25) inset}
    main{padding:16px;max-width:1100px;margin:0 auto}
    .card{background:linear-gradient(180deg,#161a3a 0%,#10142c 100%);border:1px solid #232955;border-radius:14px;padding:16px;margin-bottom:16px;box-shadow:0 8px 24px rgb(0 0 0 / .25)}
    .row{display:flex;gap:12px;flex-wrap:wrap;align-items:flex-end}
    label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
    input,select{width:100%;background:#0c1030;color:var(--text);border:1px solid #232955;padding:10px 12px;border-radius:10px;outline:none}
    .btn{background:var(--accent);color:#0a1320;border:0;padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:600}
    .btn.secondary{background:var(--accent2)}.btn.ghost{background:transparent;color:var(--text);border:1px solid #2a316a}.btn.danger{background:var(--danger);color:#fff}
    .muted{color:var(--muted)}.grid{display:grid;gap:12px}.grid.cols-2{grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
    .center{text-align:center}.big{font-size:28px;letter-spacing:.5px}.timer{font-variant-numeric:tabular-nums;font-size:20px}.question{font-size:26px;margin:8px 0 12px}
    .stat{display:flex;gap:16px;flex-wrap:wrap}.pill{padding:6px 10px;border:1px solid #2a316a;border-radius:999px;color:var(--muted)}
    table{width:100%;border-collapse:collapse;font-variant-numeric:tabular-nums}th,td{padding:8px 10px;border-bottom:1px solid #232955}tr:hover td{background:#101536}
    .ok{color:var(--accent)}.bad{color:var(--danger)}.warn{color:var(--warn)}details summary{cursor:pointer;user-select:none}.footer{opacity:.8;font-size:12px;text-align:center;padding:24px}
  </style>
</head>
<body>
  <header>
    <h1>üß† Mental Math & MM Trainer</h1>
    <nav id="tabs"></nav>
    <div style="margin-left:auto"></div>
    <button class="btn ghost" id="exportBtn">Export Stats</button>
    <button class="btn ghost" id="resetBtn" title="Alle Daten l√∂schen">Reset</button>
  </header>
  <main id="app"></main>
  <footer class="footer muted">Made for learning. Keine Originalinhalte externer Seiten. L√§uft offline.</footer>

<script>
const $=(s,e=document)=>e.querySelector(s);const $$=(s,e=document)=>[...e.querySelectorAll(s)];const now=()=>performance.now();
const DBKEY="mmtrainer_v1";const dbDefault={highscores:{},sessions:[]};let DB=loadDB();
function loadDB(){try{return JSON.parse(localStorage.getItem(DBKEY))||structuredClone(dbDefault)}catch(e){return structuredClone(dbDefault)}}
function saveDB(){localStorage.setItem(DBKEY,JSON.stringify(DB))}
function pushSession(entry){DB.sessions.push({...entry,date:new Date().toISOString()});const k=entry.module;const score=entry.stats?.score??entry.stats?.correct??0;if(!(k in DB.highscores)||score>DB.highscores[k].score){DB.highscores[k]={score,when:new Date().toISOString(),detail:entry.stats}}saveDB()}
function exportDB(){const blob=new Blob([JSON.stringify(DB,null,2)],{type:"application/json"});const url=URL.createObjectURL(blob);const a=document.createElement("a");a.href=url;a.download=`mmtrainer_stats_${new Date().toISOString().slice(0,10)}.json`;a.click();URL.revokeObjectURL(url);}
const modules=[{id:"mental",title:"Mental Math",view:viewMental},{id:"seq",title:"Sequences",view:viewSequences},{id:"mmg",title:"Market Making",view:viewMarketMaking},{id:"brain",title:"Brainteasers",view:viewBrainteasers},{id:"pin",title:"Pincode Memory",view:viewPinCode},{id:"stats",title:"Statistik",view:viewStats}];
let currentTab=localStorage.getItem("mm_tab")||"mental";
function renderTabs(){const nav=$("#tabs");nav.innerHTML="";modules.forEach(m=>{const b=document.createElement("button");b.textContent=m.title;b.className=currentTab===m.id?"active":"";b.onclick=()=>{currentTab=m.id;localStorage.setItem("mm_tab",currentTab);render()};nav.appendChild(b)})}
function render(){renderTabs();$("#app").innerHTML="";(modules.find(x=>x.id===currentTab)||modules[0]).view($("#app"))}
$("#exportBtn").onclick=exportDB;$("#resetBtn").onclick=()=>{if(confirm("Wirklich alle lokalen Daten (Scores, Sitzungen) l√∂schen?")){localStorage.removeItem(DBKEY);DB=loadDB();render()}};render();
function card(html=""){const d=document.createElement("div");d.className="card";d.innerHTML=html;return d}
function formRow(items){const r=document.createElement("div");r.className="row grid cols-2";items.forEach(x=>r.appendChild(x));return r}
function btn(label,onClick){const b=document.createElement("button");b.className="btn";b.textContent=label;b.onclick=onClick;return b}
function numberField(label,min,max,step,value,onInput,allowFloat=false){const w=document.createElement("div");const id="id"+Math.random().toString(36).slice(2);w.innerHTML=`<label for="${id}">${label}</label><input id="${id}" ${allowFloat?"":"inputmode='numeric'"} type="number" min="${min}" max="${max}" step="${step}" value="${value}">`;$("input",w).addEventListener("input",e=>onInput(allowFloat?parseFloat(e.target.value):parseInt(e.target.value)));return w}
function selectField(label,options,onChange,value){const w=document.createElement("div");const id="id"+Math.random().toString(36).slice(2);w.innerHTML=`<label for="${id}">${label}</label><select id="${id}">${options.map(([v,l])=>`<option value="${v}">${l}</option>`).join("")}</select>`;const sel=$("select",w);sel.value=value;sel.addEventListener("change",e=>onChange(e.target.value));return w}
function multiToggle(values,labels,onChange){const wrap=document.createElement("div");const id="mt"+Math.random().toString(36).slice(2);wrap.innerHTML=`<label>Typen</label><div id="${id}" class="row"></div>`;const row=$("#"+id,wrap);const sel=new Set(values);values.forEach((v,idx)=>{const b=document.createElement("button");b.className="btn ghost";b.textContent=labels[idx];b.dataset.val=v;b.onclick=()=>{if(sel.has(v))sel.delete(v);else sel.add(v);b.classList.toggle("secondary");onChange([...sel])};b.classList.add("secondary");row.appendChild(b)});return wrap}
function table(rows,headers){return `<table><thead><tr>${headers.map(h=>`<th>${h}</th>`).join("")}</tr></thead><tbody>${rows.map(r=>`<tr>${r.map(c=>`<td>${(c??"").toString().replace(/[<>&]/g,s=>({"<":"&lt;",">":"&gt;","&":"&amp;"}[s]))}</td>`).join("")}</tr>`).join("")}</tbody></table>`}
function scoreCard(moduleId){const best=DB.highscores[moduleId];const el=card("<h3>üèÜ Highscore</h3>");el.insertAdjacentHTML("beforeend",best?`<div class="stat"><span class="pill">Score: <b>${best.score}</b></span><span class="pill">Seit: ${new Date(best.when).toLocaleString()}</span></div>`:`<div class="muted">Noch kein Highscore gespeichert.</div>`);return el}
/* Mental Math */
function viewMental(root){root.appendChild(card(`<h2>üßÆ Mental Math Tests</h2><div class="muted">W√§hle Modus (Blue/Brown/Red), Anzahl & Zeitlimit. Zeit pro Aufgabe wird gespeichert.</div>`));const cfg={mode:"blue",n:15,perLimit:30};const panel=card();panel.appendChild(formRow([selectField("Modus",[["blue","Blue (leicht)"],["brown","Brown (mittel)"],["red","Red (schwer)"]],v=>cfg.mode=v,cfg.mode),numberField("Anzahl Aufgaben",5,200,1,cfg.n,v=>cfg.n=v),numberField("Zeitlimit pro Aufgabe (Sek.)",3,120,1,cfg.perLimit,v=>cfg.perLimit=v),btn("Start",async()=>{await runMentalTest(cfg,panel)})]));root.appendChild(panel);root.appendChild(scoreCard("mental"))}
function opFormat(q){switch(q.type){case"nestedDiv":return `${q.a} / (${q.b} / ${q.c})`;case"mulAdd":return `${q.a} √ó ${q.b} + ${q.c}`;case"addMul":return `${q.a} + ${q.b} √ó ${q.c}`;case"chainDiv":return `${q.a} / (${q.b} / ${q.c})`;case"quick":return `${q.a} ¬± ${q.b}`;case"mul":return `${q.a} √ó ${q.b}`;default:return `${q.a} ? ${q.b}`}} 
function genMental(mode){const r=(lo,hi)=>Math.floor(Math.random()*(hi-lo+1))+lo;const pick=a=>a[Math.floor(Math.random()*a.length)];const hard=mode==="red";const mid=mode==="brown";const types=["nestedDiv","mulAdd","addMul","chainDiv","quick","mul"];const t=pick(types);let a,b,c,ans;if(t==="nestedDiv"||t==="chainDiv"){c=r(2,hard?15:mid?12:10);b=r(2,hard?300:mid?200:160);const inner=Math.max(1,Math.floor(b/c));const k=r(2,hard?80:mid?60:40);a=inner*k;ans=a/inner}else if(t==="mulAdd"){a=r(10,hard?900:400);b=r(2,hard?99:mid?49:29);c=r(3,hard?300:mid?150:60);ans=a*b+c}else if(t==="addMul"){a=r(10,hard?900:400);b=r(2,hard?99:mid?49:29);c=r(3,hard?300:mid?150:60);ans=a+b*c}else if(t==="quick"){a=r(200,hard?2000:mid?1200:900);b=r(50,hard?600:mid?400:250);ans=Math.random()<.5?a+b:a-b}else if(t==="mul"){a=r(12,hard?99:mid?55:25);b=r(12,hard?99:mid?55:25);ans=a*b}return {q:opFormat({a,b,c,type:t}),ans,meta:{type:t}}}
async function runMentalTest(cfg,container){const n=cfg.n|0;const perLimitMs=(cfg.perLimit|0)*1000;const per=[];let correct=0,score=0;const ui=card();container.appendChild(ui);ui.innerHTML=`<div class="row" style="justify-content:space-between;align-items:center"><div class="pill">Modus: <b>${cfg.mode.toUpperCase()}</b></div><div class="timer" id="qTimer">00.0s</div></div><div class="question" id="qText"></div><div class="row"><div style="flex:1"><label>Antwort</label><input id="qAns" type="number" step="any" placeholder="Zahl & Enter"></div><button class="btn" id="qOk">OK</button><button class="btn ghost" id="qSkip">Skip</button></div><div class="muted" id="qInfo"></div>`;const qText=$("#qText",ui),qAns=$("#qAns",ui),qOk=$("#qOk",ui),qSkip=$("#qSkip",ui),qTimer=$("#qTimer",ui),qInfo=$("#qInfo",ui);let i=0,deadline=0,t0=0,timerId=null,cur=null;function setTimer(ms){const start=now();const end=start+ms;function tick(){const left=Math.max(0,end-now());qTimer.textContent=(left/1000).toFixed(1)+"s";if(left<=0){submit(true);return}timerId=requestAnimationFrame(tick)}timerId=requestAnimationFrame(tick)}function next(){if(i>=n){return done()}cur=genMental(cfg.mode);qText.textContent=cur.q+" = ?";qAns.value="";qAns.focus();t0=now();setTimer(perLimitMs);qInfo.textContent=`Aufgabe ${i+1} / ${n}`}function submit(timeout=false){if(timerId)cancelAnimationFrame(timerId);const ms=Math.round(now()-t0);const user=timeout?null:(qAns.value===""?null:Number(qAns.value));const ok=user!==null&&Math.abs(user-cur.ans)<1e-9;if(ok){correct++;score+=Math.max(1,Math.round((perLimitMs-ms)/200))}per.push({q:cur.q,correct:ok,ms,user,ans:cur.ans,meta:cur.meta});i++;next()}qOk.onclick=()=>submit(false);qSkip.onclick=()=>submit(true);qAns.addEventListener("keydown",e=>{if(e.key==="Enter")submit(false)});function done(){const avg=per.reduce((a,x)=>a+x.ms,0)/per.length;const stats={correct,total:n,avgMs:Math.round(avg),score};pushSession({module:"mental",stats,perQuestion:per});ui.innerHTML=`<h3>Ergebnis</h3><div class="stat"><span class="pill">Richtig: <b class="ok">${correct}</b> / ${n}</span><span class="pill">√ò Zeit: <b>${(stats.avgMs/1000).toFixed(2)}s</b></span><span class="pill">Score: <b>${score}</b></span></div><details open><summary>Details</summary>${table(per.map((x,idx)=>[idx+1,x.q,x.user===null?"‚Äî":x.user,x.ans,(x.ms/1000).toFixed(2)+"s",x.correct?"‚úÖ":"‚ùå"]),["#","Frage","Deine","Korrekt","Zeit","OK"])} </details>`;render()}next()}
/* Sequences */
function viewSequences(root){root.appendChild(card(`<h2>üîó Sequences</h2><div class="muted">Finde das n√§chste Element in der Sequenz. Zeitmessung & Score.</div>`));const cfg={n:12,perLimit:40,mix:["arith","geom","alt","fib"]};const panel=card();panel.appendChild(formRow([numberField("Anzahl Aufgaben",3,50,1,cfg.n,v=>cfg.n=v),numberField("Zeitlimit pro Aufgabe (Sek.)",3,120,1,cfg.perLimit,v=>cfg.perLimit=v),multiToggle(["arith","geom","alt","fib"],["Arithm.","Geom.","Altern.","Fibo*"],sel=>cfg.mix=sel),btn("Start",()=>runSeqTest(cfg,panel))]));root.appendChild(panel);root.appendChild(scoreCard("seq"))}
function genSeq(type){const r=(lo,hi)=>Math.floor(Math.random()*(hi-lo+1))+lo;const pick=a=>a[Math.floor(Math.random()*a.length)];let seq=[],next;if(type==="arith"){const a0=r(-20,30),d=r(-9,12);for(let i=0;i<5;i++)seq.push(a0+i*d);next=a0+5*d}else if(type==="geom"){const a0=r(1,9),q=pick([2,3,4,5]);for(let i=0;i<5;i++)seq.push(a0*Math.pow(q,i));next=a0*Math.pow(q,5)}else if(type==="alt"){const a0=r(-9,9),d=r(2,12);for(let i=0;i<5;i++)seq.push(i%2==0?a0+i*d:a0-i*d);next=5%2==0?a0+5*d:a0-5*d}else{const a0=r(1,9),a1=r(1,9);seq=[a0,a1];for(let i=2;i<5;i++)seq.push(seq[i-1]+seq[i-2]);next=seq[3]+seq[4]}return {seq,next,type}}
async function runSeqTest(cfg,container){const types=cfg.mix;const n=cfg.n|0,perLimitMs=(cfg.perLimit|0)*1000;const per=[];let correct=0,score=0;const ui=card();container.appendChild(ui);ui.innerHTML=`<div class="row" style="justify-content:space-between;align-items:center"><div class="pill">Typen: <b>${types.join(", ")}</b></div><div class="timer" id="qTimer">00.0s</div></div><div class="question" id="qText"></div><div class="row"><div style="flex:1"><label>N√§chstes Element</label><input id="qAns" type="number" step="any" placeholder="Zahl & Enter"></div><button class="btn" id="qOk">OK</button><button class="btn ghost" id="qSkip">Skip</button></div><div class="muted" id="qInfo"></div>`;const qText=$("#qText",ui),qAns=$("#qAns",ui),qOk=$("#qOk",ui),qSkip=$("#qSkip",ui),qTimer=$("#qTimer",ui),qInfo=$("#qInfo",ui);let i=0,t0=0,timerId=null,cur=null;function setTimer(ms){const start=now(),end=start+ms;const tick=()=>{const left=Math.max(0,end-now());qTimer.textContent=(left/1000).toFixed(1)+"s";if(left<=0){submit(true);return}requestAnimationFrame(tick)};tick()}function next(){if(i>=n){return done()}cur=genSeq(types[Math.floor(Math.random()*types.length)]);qText.textContent=cur.seq.join("  ,  ")+"  ,  ?";qAns.value="";qAns.focus();t0=now();setTimer(perLimitMs);qInfo.textContent=`Aufgabe ${i+1} / ${n}`}function submit(timeout=false){const ms=Math.round(now()-t0);const user=timeout?null:(qAns.value===""?null:Number(qAns.value));const ok=user!==null&&Math.abs(user-cur.next)<1e-9;if(ok){correct++;score+=Math.max(1,Math.round((perLimitMs-ms)/250))}per.push({q:cur.seq,correct:ok,ms,user,ans:cur.next,meta:{type:cur.type}});i++;next()}qOk.onclick=()=>submit(false);qSkip.onclick=()=>submit(true);qAns.addEventListener("keydown",e=>{if(e.key==="Enter")submit(false)});function done(){const avg=per.reduce((a,x)=>a+x.ms,0)/per.length;const stats={correct,total:n,avgMs:Math.round(avg),score};pushSession({module:"seq",stats,perQuestion:per});ui.innerHTML=`<h3>Ergebnis</h3><div class="stat"><span class="pill">Richtig: <b class="ok">${correct}</b> / ${n}</span><span class="pill">√ò Zeit: <b>${(stats.avgMs/1000).toFixed(2)}s</b></span><span class="pill">Score: <b>${score}</b></span></div><details open><summary>Details</summary>${table(per.map((x,idx)=>[idx+1,x.q.join(", "),x.user===null?"‚Äî":x.user,x.ans,(x.ms/1000).toFixed(2)+"s",x.correct?"‚úÖ":"‚ùå"]),["#","Sequenz","Deine","Korrekt","Zeit","OK"])} </details>`;render()}next()}
/* Market Making */
function viewMarketMaking(root){root.appendChild(card(`<h2>üìà Market Making (Light)</h2><div class="muted">Random-Walk Mid; Orders treffen abh√§ngig von deinem Spread. Ziel: PnL maximieren, Risiko managen.</div>`));const cfg={seconds:90,base:1000,vol:0.4,tick:200,spread:0.8,invPenalty:0.02};const panel=card();panel.appendChild(formRow([numberField("Dauer (Sek.)",30,300,5,cfg.seconds,v=>cfg.seconds=v),numberField("Startpreis",100,5000,10,cfg.base,v=>cfg.base=v),numberField("Volatilit√§t (œÉ)",0.1,2.0,0.05,cfg.vol,v=>cfg.vol=true?Number(v):v,true),numberField("Tick (ms)",50,1000,10,cfg.tick,v=>cfg.tick=v),numberField("Dein Spread (Punkte)",0.1,5,0.1,cfg.spread,v=>cfg.spread=v,true),numberField("Inventar-Penalty",0,0.1,0.005,cfg.invPenalty,v=>cfg.invPenalty=v,true),btn("Start",()=>runMM(cfg,panel))]));root.appendChild(panel);root.appendChild(scoreCard("mmg"))}
async function runMM(cfg,container){const T=cfg.seconds|0;const tick=cfg.tick|0;let timeLeft=T*1000;let mid=cfg.base;let inventory=0;let cash=0;const per=[];const ui=card();container.appendChild(ui);ui.innerHTML=`<div class="row" style="justify-content:space-between;align-items:center"><div class="pill">Zeit: <span class="timer" id="mmTime">${T.toFixed(0)}s</span></div><div class="pill">Mid: <b id="mmMid">${mid.toFixed(2)}</b></div><div class="pill">Inv: <b id="mmInv">0</b></div><div class="pill">Cash: <b id="mmCash">0.00</b></div><div class="pill">PnL: <b id="mmPnl">0.00</b></div></div><div class="row"><div><label>Spread</label><input id="mmSpread" type="number" step="0.1" value="${cfg.spread}"></div><div><label>Bias</label><input id="mmBias" type="number" step="0.1" value="0"></div><button class="btn" id="mmWider">+ Spread</button><button class="btn" id="mmTighter">- Spread</button><button class="btn ghost" id="mmFlat">Flat (alles schlie√üen)</button></div><div class="card center"><div class="big">Deine Quotes</div><div class="big"><span id="mmBid">‚Äî</span>  |  <span id="mmAsk">‚Äî</span></div></div>`;const mmTime=$("#mmTime",ui),mmMid=$("#mmMid",ui),mmInv=$("#mmInv",ui),mmCash=$("#mmCash",ui),mmPnl=$("#mmPnl",ui),mmBid=$("#mmBid",ui),mmAsk=$("#mmAsk",ui);const mmSpread=$("#mmSpread",ui),mmBias=$("#mmBias",ui);$("#mmWider",ui).onclick=()=>{mmSpread.value=(+mmSpread.value+0.2).toFixed(1)};$("#mmTighter",ui).onclick=()=>{mmSpread.value=Math.max(0.1,+mmSpread.value-0.2).toFixed(1)};$("#mmFlat",ui).onclick=()=>{cash+=inventory*mid;per.push({event:"flat",price:mid});inventory=0};function step(){const dz=(Math.random()*2-1)*cfg.vol;mid=Math.max(0.01,mid*(1+dz/1000));const spr=Math.max(0.05,+mmSpread.value);const bias=+mmBias.value;const bid=mid-spr/2-bias;const ask=mid+spr/2-bias;mmBid.textContent=bid.toFixed(2);mmAsk.textContent=ask.toFixed(2);const baseHitProb=Math.min(0.9,0.25+(0.6*(1/(1+spr))));if(Math.random()<baseHitProb*0.5){cash+=ask;inventory-=1}if(Math.random()<baseHitProb*0.5){cash-=bid;inventory+=1}const pnl=cash+inventory*mid-Math.abs(inventory)*cfg.invPenalty;mmMid.textContent=mid.toFixed(2);mmInv.textContent=inventory.toFixed(0);mmCash.textContent=cash.toFixed(2);mmPnl.textContent=pnl.toFixed(2)}const iv=setInterval(()=>{timeLeft-=tick;step();mmTime.textContent=Math.max(0,Math.round(timeLeft/1000))+"s";if(timeLeft<=0){clearInterval(iv);const pnl=cash+inventory*mid-Math.abs(inventory)*cfg.invPenalty;const stats={score:Number(pnl.toFixed(2)),cash:Number(cash.toFixed(2)),endMid:Number(mid.toFixed(2)),inventory,spread:+mmSpread.value};pushSession({module:"mmg",stats,perQuestion:[]});ui.insertAdjacentHTML("beforeend",`<div class="card"><h3>Ergebnis</h3><div class="stat"><span class="pill">PnL: <b class="${pnl>=0?'ok':'bad'}">${pnl.toFixed(2)}</b></span><span class="pill">Cash: <b>${cash.toFixed(2)}</b></span><span class="pill">Inv: <b>${inventory}</b></span><span class="pill">End-Mid: <b>${mid.toFixed(2)}</b></span></div></div>`);render()}},tick)}
/* Brainteasers */
function viewBrainteasers(root){root.appendChild(card(`<h2>üß© Brainteasers</h2><div class="muted">Kurze Aufgaben; Zeitmessung; L√∂sungen einblendbar.</div>`));const bank=[{q:"Zwei Seile brennen jeweils 60 Min. ungleichm√§√üig. Wie misst du 45 Min?",a:"Seil A an beiden Enden + Seil B an einem Ende; nach 30 Min ist A weg ‚Üí anderes Ende von B anz√ºnden ‚Üí 15 Min."},{q:"Drei Schalter, eine Lampe im Raum; Raum nur einmal betreten. Wie zuordnen?",a:"Schalter 1 an, warten, aus; Schalter 2 an; rein: an = 2, aus+warm = 1, aus+kalt = 3."},{q:"Wie viele 3-stellige Zahlen mit streng steigenden Ziffern?",a:"C(9,3)=84 (Ziffern 1‚Äì9)."}];const cfg={n:3,perLimit:120};const panel=card();panel.appendChild(formRow([numberField("Anzahl Fragen",1,bank.length,1,cfg.n,v=>cfg.n=v),numberField("Zeitlimit pro Frage (Sek.)",10,600,5,cfg.perLimit,v=>cfg.perLimit=v),btn("Start",()=>runBrain(bank,cfg,panel))]));root.appendChild(panel);root.appendChild(scoreCard("brain"))}
async function runBrain(bank,cfg,container){const n=Math.min(cfg.n,bank.length);const perLimitMs=(cfg.perLimit|0)*1000;const per=[];let correct=0,score=0;const qs=bank.slice(0).sort(()=>Math.random()-0.5).slice(0,n);const ui=card();container.appendChild(ui);ui.innerHTML=`<div class="row" style="justify-content:space-between"><div class="pill">Fragen: ${n}</div><div class="timer" id="qTimer">00.0s</div></div><div class="question" id="qText"></div><div><label>Deine Antwort (frei)</label><input id="qAns" placeholder="kurz tippen & Enter"></div><div class="row"><button class="btn" id="qOk">Weiter</button><button class="btn ghost" id="qSkip">Skip</button></div><div class="muted" id="qInfo"></div>`;const qText=$("#qText",ui),qAns=$("#qAns",ui),qOk=$("#qOk",ui),qSkip=$("#qSkip",ui),qTimer=$("#qTimer",ui),qInfo=$("#qInfo",ui);let i=0,t0=0;function setTimer(ms){const start=now(),end=start+ms;(function tick(){const left=Math.max(0,end-now());qTimer.textContent=(left/1000).toFixed(1)+"s";if(left<=0){submit(true);return}requestAnimationFrame(tick)})()}function next(){if(i>=n){return done()}const cur=qs[i];qText.textContent=cur.q;qAns.value="";qAns.focus();t0=now();setTimer(perLimitMs);qInfo.textContent=`Frage ${i+1} / ${n}`}function submit(timeout=false){const ms=Math.round(now()-t0);const user=timeout?"":qAns.value.trim();const ok=user.length>0&&!timeout;if(ok){correct++;score+=1}per.push({ms,ok});i++;next()}qOk.onclick=()=>submit(false);qSkip.onclick=()=>submit(true);function done(){const avg=per.reduce((a,x)=>a+x.ms,0)/per.length;pushSession({module:"brain",stats:{correct,total:n,avgMs:Math.round(avg),score},perQuestion:per});ui.innerHTML=`<h3>Ergebnis</h3><div class="stat"><span class="pill">Richtig: <b class="ok">${correct}</b> / ${n}</span><span class="pill">√ò Zeit: <b>${(avg/1000).toFixed(2)}s</b></span></div>`;render()}next()}
/* Pincode */
function viewPinCode(root){root.appendChild(card(`<h2>üîí Pincode Memory</h2><div class="muted">Zahl merken ‚Üí ausblenden ‚Üí eingeben. L√§nge ‚Üë bei Erfolg.</div>`));const cfg={startLen:3,showMs:2000,rounds:10};const panel=card();panel.appendChild(formRow([numberField("Start-L√§nge",2,8,1,cfg.startLen,v=>cfg.startLen=v),numberField("Anzeigedauer (ms)",800,5000,100,cfg.showMs,v=>cfg.showMs=v),numberField("Runden",5,30,1,cfg.rounds,v=>cfg.rounds=v),btn("Start",()=>runPin(cfg,panel))]));root.appendChild(panel);root.appendChild(scoreCard("pin"))}
async function runPin(cfg,container){const per=[];let correct=0,len=cfg.startLen,score=0;const ui=card();container.appendChild(ui);ui.innerHTML=`<div class="row" style="justify-content:space-between"><div class="pill">L√§nge: <b id="pinLen">${len}</b></div><div class="pill">Runde: <b id="pinRound">1</b> / ${cfg.rounds}</div></div><div class="question center" id="pinShow" style="letter-spacing:6px;font-weight:700;"></div><div class="row"><div style="flex:1"><label>Eingabe</label><input id="pinAns" inputmode="numeric" pattern="[0-9]*" placeholder="Zahl & Enter"></div><button class="btn" id="pinOk">OK</button></div><div class="muted" id="pinInfo"></div>`;const pinLen=$("#pinLen",ui),pinRound=$("#pinRound",ui),pinShow=$("#pinShow",ui),pinAns=$("#pinAns",ui),pinOk=$("#pinOk",ui);let r=0,cur=null,t0=0;function gen(n){return Array.from({length:n},()=>Math.floor(Math.random()*10)).join("")}async function round(){r++;if(r>cfg.rounds)return done();pinRound.textContent=r;cur=gen(len);pinShow.textContent=cur;pinAns.value="";await new Promise(res=>setTimeout(res,cfg.showMs));pinShow.textContent="‚Ä¢".repeat(len);pinAns.focus();t0=now()}function submit(){const ms=Math.round(now()-t0);const user=pinAns.value.trim();const ok=user===cur;if(ok){correct++;score+=Math.max(1,Math.round((5000-ms)/100));len++;pinLen.textContent=len}else{len=Math.max(cfg.startLen,len-1);pinLen.textContent=len}per.push({ms,ok});round()}pinOk.onclick=submit;pinAns.addEventListener("keydown",e=>{if(e.key==="Enter")submit()});round();function done(){const avg=per.reduce((a,x)=>a+x.ms,0)/per.length;pushSession({module:"pin",stats:{correct,total:cfg.rounds,avgMs:Math.round(avg),score},perQuestion:per});ui.insertAdjacentHTML("beforeend",`<div class="card"><h3>Ergebnis</h3><div class="stat"><span class="pill">Korrekt: <b class="ok">${correct}</b> / ${cfg.rounds}</span><span class="pill">√ò Eingabezeit: <b>${(avg/1000).toFixed(2)}s</b></span><span class="pill">Score: <b>${score}</b></span></div></div>`);render()}}
/* Stats */
function viewStats(root){root.appendChild(card(`<h2>üìä Statistik</h2><div class="muted">Sessions, √ò-Zeiten, Accuracy, Highscores. Lokal gespeichert.</div>`));const byMod={};DB.sessions.forEach(s=>{(byMod[s.module] ||= []).push(s)});Object.entries(byMod).forEach(([k,arr])=>{arr=arr.slice(-50);const el=card(`<h3>${({mental:"Mental Math",seq:"Sequences",mmg:"Market Making",brain:"Brainteasers",pin:"Pincode Memory"}[k]||k)}</h3>`);const avg=Math.round(arr.reduce((a,x)=>a+(x.stats?.avgMs||0),0)/arr.length);const acc=(arr.reduce((a,x)=>a+(x.stats?.correct||0),0))/(arr.reduce((a,x)=>a+(x.stats?.total||0),0))*100;el.insertAdjacentHTML("beforeend",`<div class="stat"><span class="pill">Sessions: <b>${arr.length}</b></span><span class="pill">√ò Zeit/Frage: <b>${(avg/1000).toFixed(2)}s</b></span><span class="pill">√ò Accuracy: <b>${isFinite(acc)?acc.toFixed(1):"‚Äî"}%</b></span><span class="pill">Highscore: <b>${DB.highscores[k]?.score??"‚Äî"}</b></span></div>`);const rows=arr.map((s,i)=>[i+1,new Date(s.date).toLocaleString(),s.stats.correct+"/"+s.stats.total,(s.stats.avgMs/1000).toFixed(2)+"s",s.stats.score??"‚Äî"]);el.insertAdjacentHTML("beforeend",table(rows,["#","Datum","Richtig","√ò Zeit","Score"]));root.appendChild(el)})}
</script>
</body>
</html>
